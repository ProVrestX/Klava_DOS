Turbo Assembler	 Version 4.1	    04/05/25 23:35:51	    Page 1
klava.asm



      1	0000			     .model tiny
      2	0000			     .code
      3				     org 100h
      4				     .186
      5
      6	      =B800		     VIDEOSEG equ 0b800h
      7
      8	0100			     .data
      9	0000  2B 2D 2B 7C 20 7C	2B+  FrameWall db '+-+|	|+-+'
     10	      2D 2B
     11	0009  41 58 3A 20 5F 5F	5F+  TextStr db	'AX: ____BX: ____CX: ____DX: ____'
     12	      5F 42 58 3A 20 5F	5F+
     13	      5F 5F 43 58 3A 20	5F+
     14	      5F 5F 5F 44 58 3A	20+
     15	      5F 5F 5F 5F
     16
     17	0029			     .code
     18	0100			     Start:
     19	0100  33 C0				     xor ax, ax
     20	0102  8E C0				     mov es, ax
     21	0104  BB 0024				     mov bx, 09h * 4
     22
     23	0107  26: 8B 07				     mov ax, es:[bx]
     24	010A  A3 016Fr				     mov Old09Ofs, ax
     25	010D  26: 8B 47	02			     mov ax, es:[bx+2]
     26	0111  A3 0171r				     mov Old09Seg, ax
     27
     28	0114  FA				     cli
     29	0115  26: C7 07	014Ar			     mov es:[bx], offset New09
     30	011A  0E				     push cs
     31	011B  58				     pop ax
     32	011C  26: 89 47	02			     mov es:[bx+2], ax
     33	0120  FB				     sti
     34
     35	0121  BB 0020				     mov bx, 08h * 4
     36	0124  26: 8B 07				     mov ax, es:[bx]
     37	0127  A3 01AAr				     mov Old08Ofs, ax
     38	012A  26: 8B 47	02			     mov ax, es:[bx+2]
     39	012E  A3 01ACr				     mov Old08Seg, ax
     40
     41	0131  FA				     cli
     42	0132  26: C7 07	0174r			     mov es:[bx], offset NewTim
     43	0137  0E				     push cs
     44	0138  58				     pop ax
     45	0139  26: 89 47	02			     mov es:[bx+2], ax
     46	013D  FB				     sti
     47
     48	013E  B8 3100				     mov ax, 3100h
     49	0141  BA 0241r				     mov dx, offset EOP
     50	0144  C1 EA 04				     shr dx, 4
     51	0147  42				     inc dx
     52	0148  CD 21				     int 21h
     53
     54				     ;------------------------------------------------
     55	014A			     New09	     proc
     56	014A  50 53 06				     push ax bx	es
     57
Turbo Assembler	 Version 4.1	    04/05/25 23:35:51	    Page 2
klava.asm



     58	014D  68 B800				     push VIDEOSEG
     59	0150  07				     pop es
     60	0151  B4 4E				     mov ah, 4eh
     61	0153  BB 00F0				     mov bx, 1*80*2 + 40*2
     62
     63	0156  E4 60				     in	al, 60h
     64	0158  26: 89 07				     mov es:[bx], ax
     65
     66	015B  E4 61				     in	al, 61h
     67	015D  8A E0				     mov ah, al
     68	015F  0C 80				     or	al, 80h
     69	0161  E6 61				     out 61h, al
     70	0163  8A C4				     mov al, ah
     71	0165  E6 61				     out 61h, al
     72
     73	0167  B0 20				     mov al, 20h
     74	0169  E6 20				     out 20h, al
     75
     76	016B  07 5B 58				     pop es bx ax
     77	016E  EA				     db	0eah
     78	016F  0000		     Old09Ofs	     dw	0
     79	0171  0000		     Old09Seg	     dw	0
     80
     81	0173  CF				     iret
     82	0174					     endp
     83				     ;------------------------------------------------
     84
     85				     ;------------------------------------------------
     86	0174			     NewTim	     proc
     87	0174  50 53 51 52 56 57	06		     push ax bx	cx dx si di es
     88
     89	017B  BF 0009r				     mov di, offset TextStr
     90
     91	017E  83 C7 04				     add di, 4
     92	0181  E8 002B				     call WordToHex
     93
     94	0184  83 C7 04				     add di, 4
     95	0187  8B C3				     mov ax, bx
     96	0189  E8 0023				     call WordToHex
     97
     98	018C  83 C7 04				     add di, 4
     99	018F  8B C1				     mov ax, cx
    100	0191  E8 001B				     call WordToHex
    101
    102	0194  83 C7 04				     add di, 4
    103	0197  8B C2				     mov ax, dx
    104	0199  E8 0013				     call WordToHex
    105
    106	019C  E8 002E				     call DrawFrame
    107	019F  E8 0077				     call DrawRegs
    108
    109	01A2  07 5F 5E 5A 59 5B	58		     pop es di si dx cx	bx ax
    110	01A9  EA				     db	0eah
    111	01AA  0000		     Old08Ofs	     dw	0
    112	01AC  0000		     Old08Seg	     dw	0
    113
    114	01AE  CF				     iret
Turbo Assembler	 Version 4.1	    04/05/25 23:35:51	    Page 3
klava.asm



    115	01AF					     endp
    116				     ;------------------------------------------------
    117
    118				     ;------------------------------------------------
    119	01AF			     WordToHex proc
    120	01AF  50 53 51				     push ax bx	cx
    121
    122	01B2  B9 0004				     mov cx, 4
    123	01B5  8B D8				     mov bx, ax
    124
    125	01B7			     ConvertLoop:
    126	01B7  C1 C3 04				     rol bx, 4
    127	01BA  8A C3				     mov al, bl
    128	01BC  24 0F				     and al, 0Fh
    129	01BE  04 30				     add al, '0'
    130	01C0  3C 39				     cmp al, '9'
    131	01C2  7E 02				     jle NumIsDec
    132	01C4  04 07				     add al, 'A' - '9' - 1
    133
    134	01C6			     NumIsDec:
    135	01C6  AA				     stosb
    136	01C7  E2 EE				     loop ConvertLoop
    137
    138	01C9  59 5B 58				     pop cx bx ax
    139
    140	01CC  C3				     ret
    141	01CD					     endp
    142				     ;------------------------------------------------
    143
    144				     ;------------------------------------------------
    145				     ; Draw a frame
    146				     ;------------------------------------------------
    147	01CD			     DrawFrame	     proc
    148
    149	01CD  68 B800				     push VIDEOSEG
    150	01D0  07				     pop es
    151	01D1  BF 0000				     mov di, 0
    152	01D4  B4 5A				     mov ah, 05ah
    153
    154	01D6  BE 0000r				     mov si, offset FrameWall
    155	01D9  B9 000C				     mov cx, 12
    156	01DC  E8 002E				     call DrawLine
    157
    158	01DF  B9 0006				     mov cx, 6
    159	01E2  BF 00A0				     mov di, 160
    160
    161	01E5			     DrawFrameLoop:
    162	01E5  51				     push cx
    163
    164	01E6  BE 0000r				     mov si, offset FrameWall
    165	01E9  83 C6 03				     add si, 3
    166	01EC  B9 000C				     mov cx, 12
    167	01EF  E8 001B				     call DrawLine
    168
    169	01F2  59				     pop cx
    170	01F3  BA 0008				     mov dx, 1 + 6 + 1
    171	01F6  2B D1				     sub dx, cx
Turbo Assembler	 Version 4.1	    04/05/25 23:35:51	    Page 4
klava.asm



    172	01F8  69 D2 00A0			     imul dx, 160
    173	01FC  8B FA				     mov di, dx
    174	01FE  E2 E5				     loop DrawFrameLoop
    175
    176	0200  BE 0000r				     mov si, offset FrameWall
    177	0203  83 C6 06				     add si, 6
    178	0206  B9 000C				     mov cx, 12
    179	0209  E8 0001				     call DrawLine
    180
    181	020C  C3				     ret
    182	020D					     endp
    183				     ;------------------------------------------------
    184
    185				     ;------------------------------------------------
    186				     ; Draw a line
    187				     ; Entry: SI - 3-Bit string	for line
    188				     ;	      CX - width line
    189				     ;	      ES:DI - addr video mem
    190				     ;	      AH - color attr
    191				     ;------------------------------------------------
    192	020D			     DrawLine	     proc
    193
    194	020D  FC				     cld
    195
    196	020E  AC				     lodsb
    197	020F  AB				     stosw
    198
    199	0210  AC				     lodsb
    200	0211  83 E9 02				     sub cx, 2
    201	0214  F3> AB				     rep stosw
    202
    203	0216  AC				     lodsb
    204	0217  AB				     stosw
    205
    206	0218  C3				     ret
    207	0219					     endp
    208				     ;------------------------------------------------
    209
    210				     ;------------------------------------------------
    211				     ; Draw regs to frame
    212				     ;------------------------------------------------
    213	0219			     DrawRegs	     proc
    214
    215	0219  BB B800				     mov bx, 0b800h
    216	021C  8E C3				     mov es, bx
    217	021E  B4 5A				     mov ah, 05ah
    218
    219	0220  B9 0004				     mov cx, 4
    220	0223  BE 0009r				     mov si, offset TextStr
    221
    222	0226			     LoopRegs:
    223	0226  8B D1				     mov dx, cx
    224	0228  69 D2 00A0			     imul dx, 160
    225	022C  BF 03C4				     mov di, 160*6 + 2*2
    226	022F  2B FA				     sub di, dx
    227	0231  51				     push cx
    228	0232  B9 0008				     mov cx, 8
Turbo Assembler	 Version 4.1	    04/05/25 23:35:51	    Page 5
klava.asm



    229	0235  E8 0004				     call DrawText
    230
    231	0238  59				     pop cx
    232	0239  E2 EB				     loop LoopRegs
    233
    234
    235	023B  C3				     ret
    236	023C					     endp
    237				     ;------------------------------------------------
    238
    239				     ;------------------------------------------------
    240				     ; Draw text to frame
    241				     ; Entry: CX - length str
    242				     ;	      SI - adr str
    243				     ;	      ES:DI - addr video mem
    244				     ;------------------------------------------------
    245	023C			     DrawText	     proc
    246
    247	023C			     LoopText:
    248	023C  AC				     lodsb
    249	023D  AB				     stosw
    250
    251	023E  E2 FC				     loop LoopText
    252
    253	0240  C3				     ret
    254	0241					     endp
    255				     ;------------------------------------------------
    256
    257
    258
    259	0241			     EOP:
    260				     end	     Start
Turbo Assembler	 Version 4.1	    04/05/25 23:35:51	    Page 6
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "04/05/25"
??FILENAME			  Text	 "klava	  "
??TIME				  Text	 "23:35:51"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0103H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 KLAVA
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
CONVERTLOOP			  Near	 DGROUP:01B7
DRAWFRAME			  Near	 DGROUP:01CD
DRAWFRAMELOOP			  Near	 DGROUP:01E5
DRAWLINE			  Near	 DGROUP:020D
DRAWREGS			  Near	 DGROUP:0219
DRAWTEXT			  Near	 DGROUP:023C
EOP				  Near	 DGROUP:0241
FRAMEWALL			  Byte	 DGROUP:0000
LOOPREGS			  Near	 DGROUP:0226
LOOPTEXT			  Near	 DGROUP:023C
NEW09				  Near	 DGROUP:014A
NEWTIM				  Near	 DGROUP:0174
NUMISDEC			  Near	 DGROUP:01C6
OLD08OFS			  Word	 DGROUP:01AA
OLD08SEG			  Word	 DGROUP:01AC
OLD09OFS			  Word	 DGROUP:016F
OLD09SEG			  Word	 DGROUP:0171
START				  Near	 DGROUP:0100
TEXTSTR				  Byte	 DGROUP:0009
VIDEOSEG			  Number B800
WORDTOHEX			  Near	 DGROUP:01AF

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0029 Word	  Public  DATA
  _TEXT				  16  0241 Word	  Public  CODE
